<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>رولت شانسی - نسخه 7 (کانورِیِر)</title>
<style>
 body{font-family:"Vazirmatn","Tahoma",sans-serif;background:#f0fbff;padding:18px;text-align:center;color:#111}
 .card{background:white;max-width:920px;margin:12px auto;padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.07)}
 button{padding:10px 16px;border-radius:8px;border:0;background:#0b7a54;color:#fff;cursor:pointer}
 select{font-weight:bold;font-size:18px;padding:10px}
 #track{height:70px;border-radius:10px;border:2px solid #0b7a54;overflow:hidden;position:relative;display:flex;align-items:center}
 .strip{display:flex;gap:24px;white-space:nowrap;padding:0 20px;will-change:transform}
 .item{font-weight:bold;font-size:20px;min-width:200px;text-align:center}
 .instagram{display:flex;align-items:center;gap:8px;justify-content:center;text-decoration:none;color:#0b7a54;font-weight:bold}
 .instagram img{width:20px;height:20px}
</style>
</head>
<body>

<img src="https://www.tasvirezendegi.com/wp-content/uploads/2014/07/s308.gif" style="max-width:240px;display:block;margin:8px auto">

<div class="card">
  <label><b>انتخاب دستی سوره:</b></label><br>
  <select id="surahSelect"></select>
</div>

<div class="card">
  <button id="spinBtn">چرخاندن (انتخاب شانسی)</button>
  <div id="track" style="margin-top:12px">
    <div id="strip" class="strip"></div>
  </div>
</div>

<div class="card" style="display:flex;justify-content:center;gap:10px">
  <button id="showBtn">نمایش ترجمه</button>
  <button id="playBtn">پخش صوت</button>
</div>

<div class="card">
  <h3 id="surahTitle"></h3>
  <div id="translation" style="font-weight:bold;text-align:justify;line-height:1.9"></div>
  <audio id="audioPlayer" controls style="display:none"></audio>
</div>

<div class="card">
  <a class="instagram" href="https://instagram.com/itszolfi" target="_blank">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Instagram_logo_2022.svg/512px-Instagram_logo_2022.svg.png" alt="ig"> صفحه اینستاگرام سازنده ربات
  </a>
</div>

<script>
const surahNames=["الفاتحه","البقره","آل‌عمران","النساء","المائده","الانعام","الاعراف","الانفال","التوبه","یونس","هود","یوسف","الرعد","ابراهیم","الحجر","النحل","الاسراء","الکهف","مریم","طه","الانبیاء","الحج","المؤمنون","النور","الفرقان","الشعراء","النمل","القصص","العنکبوت","الروم","لقمان","السجده","الاحزاب","سبأ","فاطر","یس","الصافات","ص","الزمر","غافر","فصلت","الشوری","الزخرف","الدخان","الجاثیه","الاحقاف","محمد","الفتح","الحجرات","ق","الذاریات","الطور","النجم","القمر","الرحمن","الواقعه","الحدید","المجادله","الحشر","الممتحنه","الصف","الجمعة","المنافقون","التغابن","الطلاق","التحریم","الملک","القلم","الحاقه","المعارج","نوح","الجن","المزمل","المدثر","القیامه","الانسان","المرسلات","النبأ","النازعات","عبس","التکویر","الانفطار","المطففین","الانشقاق","البروج","الطارق","الاعلی","الغاشیه","الفجر","البلد","الشمس","اللیل","الضحی","الشرح","التین","العلق","القدر","البینه","الزلزله","العادیات","القارعه","التکاثر","العصر","الهمزه","الفیل","قریش","الماعون","الکوثر","الکافرون","النصر","المسد","الاخلاص","الفلق","الناس"];
const surahEn=["Fatiha","Baqarah","AalImran","Nisa","Maidah","Anam","Araf","Anfal","Tawbah","Yunus","Hud","Yusuf","Rad","Ibrahim","Hijr","Nahl","Isra","Kahf","Maryam","Taha","Anbiya","Hajj","Muminun","Nur","Furqan","Shuara","Naml","Qasas","Ankabut","Rum","Luqman","Sajdah","Ahzab","Saba","Fatir","YaaSin","Saffat","Saad","Zumar","Ghafir","Fussilat","Shura","Zukhruf","Dukhan","Jathiyah","Ahqaf","Muhammad","Fath","Hujurat","Qaf","Dhariyat","Tur","Najm","Qamar","Rahman","Waqiah","Hadid","Mujadilah","Hashr","Mumtahinah","Saff","Jumuah","Munafiqun","Taghabun","Talaq","Tahrim","Mulk","Qalam","Haqqah","Maarij","Nuh","Jinn","Muzammil","Mudathir","Qiyamah","Insan","Mursalat","Naba","Naziat","Abasa","Takwir","Infitar","Mutaffifin","Inshiqaq","Buruj","Tariq","Alaa","Ghashiyah","Fajr","Balad","Shams","Layl","Dhuha","Sharh","Tin","Alaq","Qadr","Baiyinah","Zalzalah","Adiyat","Qariah","Takathur","Asr","Humazah","Fil","Quraysh","Maaun","Kauthar","Kafirun","Nasr","Masad","Ikhlas","Falaq","Nas"];

const sel = document.getElementById('surahSelect');
const strip = document.getElementById('strip');
const rouletteText = document.getElementById('rouletteText');
const spinBtn = document.getElementById('spinBtn');
const showBtn = document.getElementById('showBtn');
const playBtn = document.getElementById('playBtn');
const audio = document.getElementById('audioPlayer');
const translation = document.getElementById('translation');
const titleEl = document.getElementById('surahTitle');

// populate select
surahNames.forEach((s,i)=>{
  const o = document.createElement('option');
  o.value = i+1;
  o.textContent = `${i+1}. ${s}`;
  o.style.fontWeight = 'bold';
  sel.appendChild(o);
});
sel.value = 1;

// build strip (repeat twice for smooth scroll)
function buildStrip(){
  strip.innerHTML='';
  // take a sequence long enough
  const seq = surahNames.concat(surahNames).concat(surahNames);
  seq.forEach((s,i)=>{
    const d = document.createElement('div');
    d.className = 'item';
    d.textContent = s;
    strip.appendChild(d);
  });
}
buildStrip();

// translation & audio
async function fetchTranslation(num){
  translation.textContent='در حال دریافت ترجمه...';
  try{
    const r = await fetch(`https://api.alquran.cloud/v1/surah/${num}/fa.ansarian`);
    const j = await r.json();
    const ay = j.data.ayahs.map(a=>`${a.numberInSurah}. ${a.text}`);
    translation.innerHTML = ay.join('<br><br>');
    titleEl.textContent = `${num}. ${surahNames[num-1]}`;
  }catch(e){
    translation.textContent='خطا در بارگذاری ترجمه.';
  }
}
function playAudio(num){
  const link = `https://quranmehr.ir/files/audio/${num}-${surahEn[num-1]}.mp3`;
  audio.src = link;
  audio.style.display='block';
  audio.play().catch(()=>{});
}

showBtn.onclick = ()=>{ fetchTranslation(sel.value); };
playBtn.onclick = ()=>{ playAudio(sel.value); };

// این نسخه: کانورِیِر اسکرول افقی با توقف دقیق روی عنصر منتخب
spinBtn.addEventListener('click', ()=>{
  spinBtn.disabled = true;
  const total = surahNames.length;
  const chosen = Math.floor(Math.random()*total);
  // find a position inside big strip where chosen appears (we repeated 3x)
  const items = strip.querySelectorAll('.item');
  let targetIndex = -1;
  for(let i=0;i<items.length;i++){
    if(items[i].textContent === surahNames[chosen]){
      // pick a middle instance for nicer stopping (choose a middle repetition)
      if(i > total) { targetIndex = i; break; }
    }
  }
  if(targetIndex === -1) targetIndex = total; // fallback
  const itemWidth = items[0].offsetWidth + 24; // gap included
  // compute target scrollLeft so that item is centered
  const container = document.getElementById('track');
  const containerCenter = container.clientWidth / 2;
  const targetLeft = (itemWidth * targetIndex) - containerCenter + (itemWidth/2);
  const rouletteSound = new Audio('https://raw.githubusercontent.com/itsbehnamz/bottest/main/mixkit-slot-machine-payout-alarm-1996.wav');
  rouletteSound.play().catch(()=>{});
  // animate scrollLeft with requestAnimationFrame easing
  const start = container.scrollLeft;
  const duration = 6000;
  const t0 = performance.now();
  function easeOutCubic(t){ return 1 - Math.pow(1-t,3); }
  function frame(now){
    const t = Math.min(1, (now - t0)/duration);
    container.scrollLeft = start + (targetLeft - start) * easeOutCubic(t);
    // change visible center text for visual feedback
    const approxIndex = Math.round((container.scrollLeft + containerCenter - itemWidth/2)/itemWidth);
    if(approxIndex>=0 && approxIndex<items.length){
      rouletteText.textContent = items[approxIndex].textContent;
      rouletteText.style.color = `hsl(${(approxIndex*7)%360},80%,50%)`;
    }
    if(t < 1) requestAnimationFrame(frame);
    else {
      // final
      rouletteText.textContent = surahNames[chosen];
      rouletteText.style.animation = 'blink 1s infinite';
      rouletteText.style.color = 'gold';
      sel.value = chosen+1;
      fetchTranslation(chosen+1);
      playAudio(chosen+1);
      setTimeout(()=>{ spinBtn.disabled=false; },600);
    }
  }
  requestAnimationFrame(frame);
});
</script>
</body>
</html>